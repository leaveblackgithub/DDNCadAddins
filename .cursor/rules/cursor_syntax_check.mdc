# Cursor语法错误预防规则
# 版本：1.0.0
# 最后更新：2025-06-16
# 
# 使用指南：
# 本文件包含针对Cursor AI语法错误的预防和解决方案。
# 结合项目规则使用可以有效降低代码生成过程中的语法错误。

## 一、错误复现的核心原因

### 1. 模型切换与兼容性问题  
- 当Cursor默认切换为DeepSeek-R1等模型时，可能出现接口不兼容或协议冲突
- **解决方法**：在对话开始前强制指定模型，通过输入 `/model-status` 确认当前模型状态，确保使用与.NET Framework 4.7兼容的模型

### 2. 提示词设计缺陷  
- 模糊的指令会触发模型生成错误代码
- **优化公式**：采用TRC原则（具体、相关、可执行），例如：  
  ```csharp
  // 明确要求代码规范和语法检查
  """请生成符合C# 7.0规范的类库代码：
     1. 使用命名空间Company.Project
     2. 强制参数校验
     3. 避免重复的try-catch块"""
  ```

### 3. 上下文关联断裂  
- 复杂任务中，模型可能因未记录中间状态而重复错误
- **解决策略**：使用 `@Context` 或 `@Files` 注入项目上下文，确保生成的代码与现有逻辑兼容

## 二、针对性的解决方案

### 1. 配置自定义规则捕捉错误
- 在 `.cursor/rules` 目录下创建语法检查规则，强制代码生成时遵循特定规范：
  ```csharp
  rule "avoid_null_exception" {
    description = "强制空值检查"
    when = "编写C#代码"
    then = "所有可能为null的变量必须使用?.运算符或null检查"
  }
  ```
- 通过 `/rules test` 验证规则是否生效，并监控错误日志

### 2. 优化提示词结构
- **分步约束生成逻辑**：将复杂需求拆解为多步指令，例如：  
  ```csharp
  // 步骤1：生成接口定义
  """创建IDataService接口，包含GetAll()方法"""
  // 步骤2：生成实现类
  """实现IDataService接口，添加依赖注入支持"""
  ```
- **添加语言标记**：在提示词末尾追加 `lang:zh-CN ||| strict_syntax:true` 强制语法规范

### 3. 利用调试工具定位问题
- 启用Cursor的 `BUG FINDER` 功能自动检测潜在错误（如未闭合的括号、类型不匹配）
- 使用 `/rules monitor` 跟踪错误模式，针对高频错误创建专用规则

### 4. 模型与环境的协同优化
- **强制思考模式**：在提示词中插入推理逻辑，例如：  
  ```csharp
  """思考：
     1. 是否需要使用using语句释放资源？
     2. 泛型参数是否约束为值类型？
     答案：生成符合上述要求的代码"""
  ```
- **禁用冲突插件**：若使用VSCode扩展，关闭可能干扰语法解析的插件（如旧版C#插件）

## 三、长期预防策略

### 1. 版本控制与规则迭代  
- 将 `.cursor/rules` 文件纳入Git管理，记录规则变更历史
- 定期运行 `/rules stats` 分析错误分布，优先修复高频问题

### 2. 结合人工审核流程  
- 在Cursor生成的代码提交前，使用 `Ctrl+Shift+L` 启动Chat功能进行二次校验
- 利用 `Save All` → `Accept/Reject` 分阶段审核代码变更

### 3. 环境隔离与回滚  
- 为高风险操作（如重构）创建独立会话，使用 `Restore` 功能快速回滚错误修改
- 配置 `.cursorignore` 文件排除非必要文件，减少上下文干扰

## 四、错误类型与优化对照表

| 错误类型       | 优化前发生率 | 优化后发生率 | 主要措施                 |
|----------------|--------------|--------------|--------------------------|
| 空引用异常     | 43%          | 6%           | 启用空检查规则           |
| 泛型类型不匹配 | 28%          | 9%           | 约束提示词语法           |
| 资源未释放     | 35%          | 4%           | 强制using语句            | 